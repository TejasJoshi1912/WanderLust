<% layout("/layouts/boilerplate") %>

<div class="row mt-3 ">
  <div class="col-8 offset-2">
    <h3><%= listing.title %></h3>
  </div>

  <div class="card col-6 offset-2">
    <img src="<%= listing.image.url %>" class="card-img-top show-img" alt="listing_image">
    <div class="card-body">
      <p class="card-text">
        <%= listing.description %> <br>
        ₹<%= listing.price %> <br>
        <%= listing.location %> <br>
        <%= listing.country %>
      </p>
    </div>
  </div>

  <div class="btns mt-3 col-6 offset-2">
    <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark action-btn">Edit</a>

    <form method="post" action="/listings/<%= listing._id %>?_method=DELETE" style="display:inline;">
      <button id="deleteBtn" class="btn action-btn">Delete</button>
    </form>
  </div>

  <!-- Review Form -->
  <div class="col-6 offset-2 mt-4">
    <h3 class="mb-3">Leave a Review</h3>
    <form action="/listings/<%= listing._id %>/reviews" method="POST" novalidate class="needs-validation">
      <div class="mb-3">
        <label for="comments" class="form-label">Your Comments</label>
        <textarea class="form-control" id="comment" name="review[content]" required rows="3" placeholder="Write your review here..."></textarea>
        <div class="invalid-feedback">
          Please add some comments for review
        </div>
      </div>

      <div class="mb-3">
        <label for="rating" class="form-label">Rating</label>
        <input type="range" class="form-range" min="1" max="5" id="rating" name="review[rating]" step="1">
        <div class="d-flex justify-content-between">
          <small>1</small>
          <small>5</small>
        </div>
      </div>

      <button type="submit" class="btn btn-outline-dark mb-4">Submit Review</button>
    </form>

    <hr>
    <h4>All Reviews</h4>

    
<div class="row g-1">
  <% for(let review of listing.reviews) { %>
    <div class="col-md-6 mb-2">
      <div class="card h-100 shadow-sm">
        <div class="card-body" id="reviews-card">
          <h6 class="card-subtitle mb-2 text-muted">Rating: <%= review.rating %> ⭐</h6>
          <p class="card-text mb-2"><%= review.content %></p> <!-- mb-2 adds space above the footer -->

          <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
            <button type="submit" class="btn btn-dark btn-sm ">Delete</button>
          </form>
        </div>
      </div>
    </div>
  <% } %>
</div>

  </div>
</div>